version: v1
name: Ingest Transform Refresh Pipeline
pipeline:
  b8617bc2-a542-4a6f-acb9-1dbef29d9616:
    tasks:
      64d62730-73ba-4538-9885-802affa163ad:
        integration: PYTHON
        integration_job: PYTHON_EXECUTE_SCRIPT
        parameters:
          command: python -m sftp
          package_manager: PIP
          python_version: '3.12'
          build_command: pip install -r requirements.txt
          environment_variables: '{

            "FILE_PATH":"orders.json"

            }'
          project_dir: python/integration_a
          shallow_clone_dirs: python/integration_a
          set_outputs: true
        depends_on: []
        condition: null
        name: Load data from SFTP
        tags: []
        connection: python__production__blueprints__19239
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
    depends_on: []
    condition: null
    name: ''
  aa71e5fa-228b-4839-96dd-54bcd2f7c4fb:
    tasks:
      e65322a4-7a6f-4cdd-b40c-160b97c36c14:
        integration: DBT_CORE
        integration_job: DBT_CORE_EXECUTE
        parameters:
          commands: dbt build;
          package_manager: PIP
          python_version: '3.12'
          project_dir: dbt_projects/postgres/jaffle_shop_postgres
          shallow_clone_dirs: dbt_projects/postgres/jaffle_shop_postgres
          warehouse_identifier: postgres
        depends_on: []
        condition: null
        name: dbt build
        tags: []
        connection: postgres__prod__27132
        operation_metadata: null
        treat_failure_as_warning: true
        configuration: null
      be27adc0-ef6a-4e17-a581-98c12e18de5f:
        integration: POSTGRES
        integration_job: POSTGRES_RUN_QUERY
        parameters:
          statement: "INSERT INTO test (id, name)\nVALUES\n\n    (9, 'Charlie');\n"
          set_outputs: false
        depends_on: []
        condition: null
        name: Execute Insert
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
    depends_on:
    - b8617bc2-a542-4a6f-acb9-1dbef29d9616
    - b91a2f41-d249-47da-a17b-a42e32b4d64e
    - c2c01b6e-ba7f-4c11-aad8-639ae2c84ada
    condition: null
    name: ''
  b91a2f41-d249-47da-a17b-a42e32b4d64e:
    tasks:
      4089faf2-e236-43f0-955a-f4c93ae771e9:
        integration: AWS_EC2
        integration_job: AWS_EC2_SSM_RUN_SCRIPT
        parameters:
          instance_id: i-0e27e289e188fa433
          command: "echo \"Starting data ingestion\"\ncat << 'EOF' > random_logger.sh\n\
            generate_random_message() {\n    echo \"Random Message $((RANDOM % 100\
            \ + 1))\"\n}\n\n# Start time\nstart_time=$(date +%s)\n\n# Run for 20 seconds\n\
            while [ $(($(date +%s) - start_time)) -lt 20 ]; do\n    # Get the current\
            \ time\n    current_time=$(date '+%Y-%m-%d %H:%M:%S')\n    \n    # Generate\
            \ a random message\n    random_message=$(generate_random_message)\n  \
            \  \n    # Log the message\n    echo \"$current_time - $random_message\"\
            \n    \n    # Wait for a random interval between 0.5 and 2 seconds\n \
            \   sleep_time=$(awk -v min=0.5 -v max=2 'BEGIN{srand(); print min+rand()*(max-min)}')\n\
            \    sleep $sleep_time\ndone\n\n# Exit the program\nexit 0\nEOF\nsleep\
            \ 2\nchmod +x random_logger.sh\n./random_logger.sh\necho \"Goodbye\""
          os_type: linux
        depends_on: []
        condition: null
        name: Run job on EC2
        tags: []
        connection: ec2_test_36880
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      d559352f-685d-413b-bf71-2d79cdeb1c99:
        integration: AWS_LAMBDA
        integration_job: AWS_LAMBDA_EXECUTE_ASYNC_FUNCTION
        parameters:
          function_name: aws_lambda_test
          set_outputs: false
        depends_on: []
        condition: null
        name: Ingest Lambda
        tags: []
        connection: aws_lambda__dev__70069
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
    depends_on: []
    condition: null
    name: ''
  c2c01b6e-ba7f-4c11-aad8-639ae2c84ada:
    tasks:
      676e8324-f0ec-4da0-9c73-252664b548ec:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: manual_carrier
        depends_on: []
        condition: null
        name: Ingest with Fivetran
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      255dcf62-ca96-44d3-95e9-73f56fe29fb1:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: rapidly_growing
        depends_on: []
        condition: null
        name: rapidly_growing
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      3ed29773-55ba-4a1e-ab32-d159fe263191:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: ai_workflow
        depends_on: []
        condition: null
        name: ai_workflow
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      d49679fa-6bc3-4149-ac30-597c18d0aedc:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: data_pipeline
        depends_on: []
        condition: null
        name: data_pipeline
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      e853e265-48b2-4825-9f55-0e36950cb9b6:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: seed_raising
        depends_on: []
        condition: null
        name: seed_raising
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
      934c4d6e-33f9-4533-8f5e-27d8a550aa42:
        integration: FIVETRAN
        integration_job: FIVETRAN_SYNC_ALL
        parameters:
          connector_id: tech_company
        depends_on: []
        condition: null
        name: tech_company
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
    depends_on: []
    condition: null
    name: ''
  18341e6a-2689-42ef-97cb-729e4d1211e9:
    tasks:
      8aa59e36-1b68-4444-822b-648cf991b666:
        integration: POWER_BI
        integration_job: POWER_BI_REFRESH_DATASET
        parameters:
          dataset_id: 5e83dd8a-2c30-44ec-8f53-e5e751ae515d
        depends_on: []
        condition: null
        name: Refresh Dataset
        tags: []
        connection: null
        operation_metadata: null
        treat_failure_as_warning: null
        configuration: null
    depends_on:
    - aa71e5fa-228b-4839-96dd-54bcd2f7c4fb
    condition: null
    name: ''
schedule: []
sensors:
  f910c9f8-99e5-4c21-a30d-399b9c96bab1:
    name: Daily
    cron: 0 7 ? * * *
    timezone: UTC
    timeout_mins: 1440
    environments: null
    checks:
      Check First Pipeline:
        integration: ORCHESTRA
        connection: null
        sensor_type: ORCHESTRA_PIPELINE_STATUS
        parameters:
          pipeline_id: 64fb7f67-172f-4c77-9984-1aa3d133c079
          statuses:
          - SUCCEEDED
          check_latest_run: false
        map_outputs: null
      Check CRM:
        integration: ORCHESTRA
        connection: null
        sensor_type: ORCHESTRA_PIPELINE_STATUS
        parameters:
          pipeline_id: 8835c6b0-f98e-4530-adfe-3fef7c94466c
          statuses:
          - SUCCEEDED
          check_latest_run: false
        map_outputs: null
    condition: null
    exclude: null
    frequency_secs: null
    run_inputs: null
trigger_events: []
webhook:
  enabled: false
  operation_metadata: null
  run_inputs: null
configuration: null
inputs:
  dbt_models:
    type: string
    default: table_a+ table_b+
    optional: null
